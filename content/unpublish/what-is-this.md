---
title: ç›˜æ ¹é”™èŠ‚çš„å¯„ç”Ÿä¸–ç•Œä¹‹å¤ºèˆthisä¼ é€’
date: 2023-05-09T10:00
authors: Barry
category: coding
layout: article
---

## å‰è¨€

this ä¼ é€’ç›¸å½“äºä¸€ä¸ªæ¶¦æ»‘æ²¹ä¸€èˆ¬çš„çŸ¥è¯†ï¼Œå®ƒç»“åˆåŸå‹ä¼ é€’å¼•ç”¨å®ç°ç±»ç»§æ‰¿çš„æœºåˆ¶ã€‚

å®ƒæ˜¯ç±»ç»§æ‰¿ï¼Œå¤–è¡¨çœ‹æˆåƒç»§æ‰¿ï¼Œå…¶å®å†…éƒ¨æ˜¯å¯„ç”Ÿã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»äº†è§£äº†åŸå‹çš„åŸºæœ¬æœºæ„ï¼Œå¦‚æœæƒ³è¦è¿›ä¸€æ­¥æŠŠâ€œç»§æ‰¿â€æ‰€ç†è§£ï¼Œå°±éœ€è¦é€šè¿‡ this ä¼ é€’æ¥è¡¥å……ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯"ç»§æ‰¿â€

è®©æˆ‘ä»¬ç›´æ¥å¼€å§‹ã€‚

## æ­£æ–‡

é¦–å…ˆæˆ‘ä»¬è¦å›é¡¾ä¸€å¥éå¸¸é‡è¦çš„è¯ã€‚

> ğŸ“· Javascript çš„ä¸–ç•Œé‡Œé¢ä¸€åˆ‡çš†å¯¹è±¡

æˆ‘ä»¬çš„ this ä¼ é€’ï¼Œä¼ é€’ä¹Ÿæ˜¯å¯¹è±¡ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¼šåœ¨ä»€ä¹ˆåœ°æ–¹ç”¨åˆ° this è¿™ä¸ªå…³é”®è¯ï¼Ÿ

å‡½æ•°ä½“ä¸­ã€‚

é‚£ä¹ˆæˆ‘ä»¬å‡½æ•°æ”¾ç½®çš„ä½ç½®å°±å†³å®š this ç»‘å®šçš„æœºåˆ¶ï¼ˆè¿™ä¹Ÿæ˜¯æ‰€è°“çš„è¯æ³•ä½œç”¨åŸŸåšå†³å®š, è¿™é‡Œåº”è¯¥ä¼šæœ‰ä¸€ç¯‡æ–‡ç« ï¼‰ã€‚

è¯·çœ‹ä»¥ä¸‹ä»£ç 

ä¸€ç§æ˜¯æ„é€ å‡½æ•°ï¼Œä¸€ç§æ˜¯æ™®é€šå‡½æ•°åœ¨å¯¹è±¡å†…éƒ¨

å½“ç„¶å¦‚æœä¸åœ¨è¿™ä¸¤ä¸ªé‡Œé¢ï¼Œå•çº¯å‡ºç°åœ¨å…¨å±€ä¸‹é¢ this å°±æ˜¯å–çš„å…¨å±€å˜é‡

åœ¨ nodejs é‡Œé¢æ˜¯ globalThisï¼Œåœ¨æµè§ˆå™¨å°±æ˜¯ window (strict æ¨¡å¼ä¸‹å»ä¸åˆ°)

```javascript
function Foo(a) {
  this.a = a;
}

const bar = {
  b: function () {
    console.log(this.a);
  },
  c() {
    console.log(this.a);
  },
  d: () => {
    console.log(this.a);
  },
  e: (function () {
    return () => {
      console.log(this.a);
    };
  })(),
  f: function () {
    return () => {
      console.log(this.a);
    };
  },
};
```

### æ„é€ å‡½æ•°

æˆ‘ä»¬å…ˆä»æ„é€ å‡½æ•°è¿™ä¸ªç±»å‹å¼€å§‹æ¯”è¾ƒç®€å•

é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ new æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™æ ·æ‰æœ‰ thisï¼Œå› ä¸ºåˆ›å»ºçš„è¿™ä¸ªæ–°å¯¹è±¡å°±æ˜¯ä¼ é€’è¿‡æ¥çš„ this

æˆ‘ä»¬æ‰èƒ½å°† a æŒ‚è½½åˆ°äº†åˆ›å»ºçš„æ–°å¯¹è±¡ä¸Š

ä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬æ¢ä¸ªè§’åº¦ï¼Œä¸å¦‚æˆ‘ä»¬ç›´æ¥è°ƒç”¨ Foo å‘¢ï¼Ÿ

```javascript
function Foo(a) {
  this.a = a;
}

Foo(1);
```

this æ˜¯ä»€ä¹ˆï¼Ÿ

æƒ³å¿…èªæ˜ä½ çš„ä¸€å®šçŸ¥é“ï¼Œwindow

æ²¡é”™å°±æ˜¯ windowï¼Œé‚£ä¹ˆåˆšå…¥é—¨çš„å°æœ‹å‹å°±è¦é—®äº†ã€‚ï¼ˆå…¶å®å†™çš„æ—¶å€™æˆ‘è‡ªå·±ä¹Ÿå¿˜äº† --!ï¼‰

> Barry å”å”ä¸ºä»€ä¹ˆæ˜¯ window å•Šï¼Ÿ

è¿™å°±ä¸å¾—ä¸æä¸€ä¸‹ä¼ é—»ä¸­çš„è¯æ³•ä½œç”¨åŸŸã€‚

ä»€ä¹ˆæ˜¯è¯æ³•ä½œç”¨åŸŸï¼ŒæŠ›å¼€ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„çŸ¥è¯†ç‚¹ï¼Œå…‰çœ‹å’Œè¿™é‡Œç»“åˆæœ€ç´§å¯†çš„çŸ¥è¯†ç‚¹ã€‚

è¯æ³•ä½œç”¨åŸŸå°±æ˜¯ ä½ çš„å‡½æ•°ä¹¦å†™ï¼ˆå£°æ˜ï¼‰çš„ä½ç½®å†³å®šäº†ä½ çš„å˜é‡è®¿é—®æƒé™ï¼Œä¹Ÿå°±æ˜¯ä½ çš„ä½œç”¨åŸŸé“¾ã€‚ï¼ˆè¿™é‡Œåº”è¯¥ä¹Ÿè¦æœ‰ä¸€ç¯‡æ–‡ç« , å›é¡¾ä¸€ä¸‹ä½œç”¨åŸŸé“¾ï¼‰

æˆ‘ä¼šç”¨ä¸€ä¸ªä¾‹å­æ¥ç¨å¾®å›é¡¾ä¸€ä¸‹ï¼Ÿ

å…ˆçœ‹å¦‚ä¸‹ä»£ç 

```javascript
let name = "Barry Song";

function hi() {
  console.log(name);
}

function hiSuperman() {
  let name = "Clark Kent";
  console.log(name);
}

function hiBatman() {
  let name = "Bruce Wayen";
  hi();
}

hi(); // Barry Song
hiSuperman(); //Clark Kent
hiBatman(); //Barry Song
```

çœ‹äº†ä»£ç æ˜¯ä¸æ˜¯è®°èµ·æ¥ä»€ä¹ˆæ˜¯æ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œå¦‚æœæ²¡æœ‰ææ¸…æ¥šï¼Œè¯·çœ‹å¦‚ä¸‹æ–‡ç« 

é‚£ä¹ˆæˆ‘ä»¬åœ¨å†æ¬¡å›åˆ°è¿™æ®µä»£ç 

```javascript
function Foo(a) {
  this.a = a;
}

Foo(1);
```

æˆ‘ä»¬åœ¨ç›´æ¥è°ƒç”¨ Foo å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ Foo å£°æ˜åˆ°äº†å…¨å±€ä½œç”¨åŸŸé‡Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®¿é—® thisï¼Œthis æ˜¯ä¸€ä¸ªå¯¹è±¡çš„åº”ç”¨ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„æ—¶å€™å‘ç° Foo è¿™ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œé¢æ²¡æœ‰ this,é‚£ä¹ˆæˆ‘å°±å¾€å¤–é¢æ‰¾ï¼Œå¤–é¢å°±æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œå…¨å±€ä½œç”¨åŸŸæ‰¾ï¼Œä½œä¸ºå…¨å±€ä½œç”¨åŸŸçš„ this ä»–å°±æ˜¯ windowï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„ a = 1 æ”¾åœ¨äº† window ä¹‹ä¸Š

æˆ‘ä»¬éªŒè¯ä¸€ä¸‹

[![p9BmMKx.png](https://s1.ax1x.com/2023/05/09/p9BmMKx.png)](https://imgse.com/i/p9BmMKx)

ä¸€ç‚¹å°æ’æ›²è¿‡åï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°æ„é€ å‡½æ•°çš„ this ä¼ é€’ä¸Šé¢æ¥ï¼Œåé¢è¿™ä¸ªä½œç”¨åŸŸ this çš„ä¼ é€’è¿˜è¦åœ¨è¯´ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒå¾ˆé‡è¦ã€‚

ç°åœ¨ä» new ä¸€ä¸ªæ„é€ å‡½æ•°ä¸Šé¢çœ‹

```javascript
function Foo(a) {
  this.a = a;
}

const bar = new Foo(1);
```

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æŒ‡å®šç»™ thisï¼Œåœ¨ this ä¸Šé¢æŒ‚äº†ä¸€ä¸ª a çš„å˜é‡

è¿™å°±æ˜¯æœ€åŸºç¡€çš„ä¼ é€’ thisï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿æˆ–è€…è¯´å¯„ç”Ÿçš„åŸºç¡€

ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰æ„Ÿå—åˆ°å¯„ç”Ÿçš„å‘³é“ï¼Œä¹Ÿå°±æ˜¯æˆ‘æ˜¯è®© Foo å¸®æˆ‘åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸æ˜¯ bar æ˜¯ç»§æ‰¿äº† Foo çš„èƒ½åŠ›

æ‰¯è¿œäº†ï¼Œè¿™é‡Œæœ‰ä¸€é“è‘—åçš„é¢è¯•é¢˜ï¼Œnew çš„èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

æœ‰ä»¥ä¸‹å››ç‚¹

- åˆ›å»ºä¸€ä¸ªå¯¹è±¡
- æ–°å¯¹è±¡çš„[[prototype]]å±æ€§æŒ‡å‘æ„é€ å‡½æ•°çš„ prototype (å¦‚æœä¸æ˜ç™½è¿™é‡Œï¼Œè¯·çœ‹ä¸Šä¸€ç¯‡æ–‡ç« [[prototype]]å’Œ prototype çš„åŒºåˆ«)
- å°†è¿™ä¸ªæ–°çš„å¯¹è±¡èµ‹ç»™ this
- å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–çš„å€¼ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªåˆ›å»ºçš„å¯¹è±¡

è¿™é‡Œå°¤å…¶æ˜¯ç¬¬äºŒç‚¹å®¹æ˜“å¿˜è®°ï¼Œå…¶ä»–çš„å€’æ˜¯æ²¡æœ‰ä»€ä¹ˆã€‚

### å¤šç§å‡½æ•°çš„ this è°ƒç”¨

```javascript
function Foo(a) {
  this.a = a;
}

const bar = {
  b: function () {
    console.log(this.a);
  },
  c() {
    console.log(this.a);
  },
  d: () => {
    console.log(this.a);
  },
  e: (function () {
    return () => {
      console.log(this.a);
    };
  })(),
  f: function () {
    return () => {
      console.log(this.a);
    };
  },
};
```

1. ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°æœ€ä¸ºç‰¹æ®Šï¼Œç®­å¤´å‡½æ•°æ˜¯æ— æ³•ç»‘å®š this çš„ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°æ˜¯æ²¡æ³•åšæ„é€ å‡½æ•°ï¼Œå…ˆçœ‹ä¸‹é¢ä»£ç 

```javascript
const Foo = () => {
  this.a = 1;
};

const bar = new Foo(1);
```

[![p9BuB4g.png](https://s1.ax1x.com/2023/05/09/p9BuB4g.png)](https://imgse.com/i/p9BuB4g)

å…¶æ¬¡å°±æ˜¯ç®­å¤´å‡½æ•°ä¸èƒ½é€šè¿‡ call å’Œ bindï¼Œapply æ”¹å˜ this æŒ‡å‘ (è¿™é‡Œæœ‰ä¸€ç¯‡å°æ–‡ç« å¤ä¹ ä¸€ä¸‹ call bind, apply)

2. åŒ¿åå‡½æ•°å’Œå…·åå‡½æ•°

3. é—­åŒ…å‡½æ•°
